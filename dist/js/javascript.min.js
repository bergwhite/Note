"use strict";!function(){function t(t){function e(){var t=$(".note-login"),e=$(".note-logined");if($.cookie("user")){var n=$.cookie("user"),o=$(".user-name");return t.hide(),o.text(n),e.show(),!0}return e.hide(),t.show(),!1}return{login:e}}function e(t,e){var n=$(".modal"),o=$(".modal-title"),a=$(".modal-body"),l=$(".modal-footer");n.attr("id",e.replace("#","")),o.empty(),a.empty(),l.empty();var s={login:{title:"登陆",body:'\n          <form>\n                <div class="form-group">\n                  <label for="user" class="control-label">账号</label>\n                  <input type="text" class="form-control loginUser" id="user">\n                </div>\n                <div class="form-group">\n                  <label for="pass" class="control-label">密码</label>\n                   <input type="password" class="form-control loginPass" id="pass">\n                </div>\n              </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary loginConfirm">登陆</button>\n        '},register:{title:"注册",body:'\n          <form>\n                <div class="form-group">\n                  <label for="user" class="control-label">账号</label>\n                  <input type="text" class="form-control registerUser" id="user">\n                </div>\n                <div class="form-group">\n                  <label for="pass" class="control-label">密码</label>\n                  <input type="password" class="form-control registerPass1" id="pass">\n                </div>\n                <div class="form-group">\n                  <label for="confirm-pass" class="control-label">确定密码</label>\n                  <input type="password" class="form-control registerPass2" id="confirm-pass">\n                </div>\n              </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary registerConfirm">注册</button>\n        '},add:{title:"添加",body:'\n          <form>\n            <div class="form-group">\n              <label for="title" class="control-label">标题</label>\n              <input type="text" class="form-control addTitle" id="title">\n            </div>\n            <div class="form-group">\n              <label for="content" class="control-label">内容</label>\n              <textarea  class="form-control addContent" id="content"></textarea>\n            </div>\n            <div class="form-group">\n              <label for="tag" class="control-label">标签</label>\n              <input type="text" class="form-control addTag" id="tag">\n            </div>\n          </form>\n        ',footer:'\n          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n              <button type="button" class="btn btn-primary addConfirm">添加</button>\n        '}};o.append(s[t].title),a.append(s[t].body),l.append(s[t].footer)}function n(t,e,n){var o=new XMLHttpRequest;o.open(t,e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var t=JSON.parse(o.responseText);console.log(t),("yes"===t.registerState||"yes"===t.loginState||"login..."===t.loginState||t.logoutState||"yes"===t.deleteState||"yes"===t.addState)&&location.reload()}},o.send(n)}function o(t,e,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var t=JSON.parse(o.responseText),e=$(".notes");if(e.empty(),console.log(t),"no"!==t.loginState)if(0!==t.length)for(var n in t){var a=t[n].id,l=t[n].title,s=t[n].content,r='\n                <div class="row note" id="'+a+'">\n                  <div class="note-title">\n                    <p class="text-center note-title-content">'+l+'</p>\n                    <div class="note-control">\n                      <span class="glyphicon glyphicon-pencil ctrl-edit"></span>\n                      <span class="glyphicon glyphicon-trash ctrl-del"></span>\n                    </div>\n                  </div>\n                  <div class="note-content">'+s+"</div>\n                </div>\n              ";e.append(r)}else{var i='<p class="note text-center">没有发现笔记哦，试着去添加一条笔记吧 ^_^</p>';e.append(i)}else{var c='<p class="note text-center">没有发现笔记哦，请登陆 ^_^</p>';e.append(c)}}},o.open(t,e,!0),o.send()}function a(t){function e(){var t=$(".registerUser"),e=$(".registerPass1"),o=$(".registerPass2");if(e.val()===o.val()){var a={user:t.val(),pass:e.val()},l="";for(var s in a)l+=s+"="+a[s]+"&";console.log(l),n("POST","/Note/api/user/register.php","user="+a.user+"&pass="+a.pass+"&mail=")}else o.addClass("alert alert-warning")}function o(){var t=$(".loginUser"),e=$(".loginPass"),o={user:t.val(),pass:e.val()};console.log("user:"+o.user),console.log("pass:"+o.pass),n("POST","/Note/api/user/login.php","user="+o.user+"&pass="+o.pass)}function a(){var e=t.find(".note-title-content"),o=t.find(".note-content");e.attr("contenteditable","true"),e.focus(),o.attr("contenteditable","true"),console.log("title"),console.log("content"),t.mouseleave(function(a){$("body").click(function(){e.attr("contenteditable","false"),o.attr("contenteditable","false");var a=e.text(),l=o.text();console.log(a),console.log(l),n("POST","/Note/api/note/modify.php","noteId="+i+"&title="+a+"&content="+l),t.unbind(""),$("body").unbind("")})})}function l(){var t=$(".addTitle"),e=$(".addContent"),o=$(".addTag"),a=new Date,l=(a.getTime(),{title:t.val(),content:e.val(),tag:o.val(),date:"2017-03-11"});n("POST","/Note/api/note/add.php","title="+l.title+"&content="+l.content+"&tag="+l.tag+"&date="+l.date)}function s(){n("POST","/Note/api/note/delete.php","noteId="+i)}function r(){n("POST","/Note/api/user/logout.php")}if(void 0!==t){var t=t.parent().parent().parent(),i=t.attr("id");console.log(t),console.log(i)}return{register:e,login:o,add:l,edit:a,del:s,logout:r}}!function(){var n=t().login();if(n){o("GET","/Note/api/note/search.php");var l=($(".ctrl-edit"),$(".ctrl-del"),$(".ctrl-add")),s=l.attr("id"),r=l.attr("data-target"),i=$(".logout");l.click(function(){return e(s,r)}),$(document).on("click",".addConfirm",function(){return a().add()}),i.click(function(){return a().logout()}),$(document).on("click",".ctrl-edit",function(){a($(this)).edit()}),$(document).on("click",".ctrl-del",function(){a($(this)).del()})}else{var c=$("#login"),d=c.attr("id"),p=c.attr("data-target").replace("#",""),u=$("#register"),f=u.attr("id"),g=u.attr("data-target").replace("#","");c.click(function(){e(d,p)}),$(document).on("click",".loginConfirm",function(){a().login(),window.event.cancelBubble=!0}),u.click(function(){return e(f,g)}),$(document).on("click",".registerConfirm",function(){return a().register()})}}()}();